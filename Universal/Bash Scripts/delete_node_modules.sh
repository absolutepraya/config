#!/bin/bash

# -----------------------------------------------------------------------------
# Script Name: remove_node_modules.sh
# Description: Recursively removes all 'node_modules' directories from the
#              current directory downward without affecting parent directories.
# Usage:       ./remove_node_modules.sh
# Warning:     This script permanently deletes directories. Use with caution.
# -----------------------------------------------------------------------------

# Function to display an informational message
info() {
    echo -e "[INFO] $1"
}

# Function to display an error message and exit
error_exit() {
    echo -e "[ERROR] $1" >&2
    exit 1
}

# Check if the current directory is accessible
if [ ! -d "." ]; then
    error_exit "Current directory is not accessible."
fi

info "Starting removal of all 'node_modules' directories from $(pwd)"

# Find and remove all 'node_modules' directories
# Explanation:
# - '.' specifies the current directory as the starting point.
# - '-type d' ensures that only directories are matched.
# - '-name "node_modules"' searches for directories named 'node_modules'.
# - '-prune' prevents find from descending into 'node_modules' directories.
# - '-exec rm -rf {} +' executes the remove command on the found directories.
find . -type d -name "node_modules" -prune -exec rm -rf "{}" +

# Check if the find command was successful
if [ $? -eq 0 ]; then
    info "All 'node_modules' directories have been successfully removed."
else
    error_exit "An error occurred while trying to remove 'node_modules' directories."
fi
